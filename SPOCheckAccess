# Get token manually
$clientId = "your-app-client-id"
$tenantId = "your-tenant-id"
$clientSecret = "your-client-secret"

$tokenBody = @{
    Grant_Type    = "client_credentials"
    Scope         = "https://graph.microsoft.com/.default"
    Client_Id     = $clientId
    Client_Secret = $clientSecret
}

$tokenResponse = Invoke-RestMethod -Uri "https://login.microsoftonline.com/$tenantId/oauth2/v2.0/token" -Method POST -Body $tokenBody
$accessToken = $tokenResponse.access_token

# Make direct REST call to Graph API
$headers = @{
    'Authorization' = "Bearer $accessToken"
    'Content-Type'  = 'application/json'
}

# Test site access
$siteUrl = "yourtenant.sharepoint.com:/sites/yoursite"
$encodedSiteUrl = [System.Web.HttpUtility]::UrlEncode($siteUrl)
$response = Invoke-RestMethod -Uri "https://graph.microsoft.com/v1.0/sites/$encodedSiteUrl" -Headers $headers -Method Get

Write-Host "Successfully connected to site:" $response.displayName
Write-Host "Site ID:" $response.id
